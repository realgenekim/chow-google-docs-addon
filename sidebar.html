<!DOCTYPE html>
<html>
  <head>
    <script>
      
     
    </script>
  </head>
  <body>
    <h3>CHOW Workbench</h3>
    <p>Written to make it easier to CHOW: assemble and sling prompts around to paste them into an LLM.</p>
        <br>
        
    <div id="selected-text" style="margin-top: 10px; white-space: pre-wrap;"></div>
    <div id="manuscript-context" style="margin-top: 10px; white-space: pre-wrap;">Manuscript not loaded: click "Get Document" to load</div>

    <br>

    <button onclick="reloadSidebar()">Reload Sidebar</button>
    <button onclick="getDoc()">Read Source Docs</button>
    <button onclick="getSelection2()">Get Selection</button>
    <button onclick="copyToClipboard()">Copy to Clipboard</button>  
    <div id="debug" style="margin-top: 20px; color: red;"></div>
  </body>
</html>

<script>
  function onButtonClick() {
    document.getElementById('debug').innerHTML += '<br>onButtonClick called!';
    google.script.run.showAlert();
  }

  document.getElementById('debug').innerHTML += '<br>BEGIN!';
  
  function getSelection2() {
    document.getElementById('debug').innerHTML += '<br>getSelection called!';
    document.getElementById('debug').innerHTML += '<br>getSelection called';
    google.script.run
      .withSuccessHandler(function(text) {
        document.getElementById('debug').innerHTML += '<br>Success handler called with text: ' + text;
        document.getElementById('selected-text').innerHTML = text;
      })
      .withFailureHandler(function(error) {
        document.getElementById('debug').innerHTML += '<br>Error: ' + error;
      })
      .getSelectedText();
  }

  function getDoc() {
    document.getElementById('debug').innerHTML += '<br>getDoc called!';
    google.script.run
      .withSuccessHandler(function(content) {
        const wordCount = content.trim().split(/\s+/).length;
        document.getElementById('manuscript-context').innerHTML = `Word count: ${wordCount}`;
      })
      .withFailureHandler(function(error) {
        document.getElementById('debug').innerHTML += '<br>Error: ' + error;
      })
      .getDoc();
      document.getElementById('debug').innerHTML += '<br>getDoc returned (takes about 10s to finish loading)!';
  }
  function reloadSidebar() {
    google.script.run.triggerSidebarReload();  // Calls the function in Apps Script
    google.script.host.close();  // Closes the sidebar
  }

  async function copyToClipboard() {
    try {
      await navigator.clipboard.writeText('abc');
      document.getElementById('debug').innerHTML += '<br>Copied to clipboard!';
    } catch (err) {
      document.getElementById('debug').innerHTML += '<br>Failed to copy: ' + err;
    }
  }
</script>
